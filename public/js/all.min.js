var Box,Grid,Server,active,canvas_xlimits,distrib,grid,heartbeats,line,rhclusters,server,serverJson,servers,web_app,x,y,_i,_j,_len,_len2;window.Grid=Grid=function(){function a(a){a==null&&(a={}),this.options=a}a.prototype.distribute_horizontally=function(a,b,c,d){var e,f,g,h,i;e=function(){var b;b=[];for(i=1;1<=a?i<=a:i>=a;1<=a?i++:i--)b.push(i);return b}(),e=e.map(function(a){return a*b}),f=(d+c)/2,h=b*(a-1)/2,g=f-h,e=e.map(function(a){return g-b+a});return e};return a}(),window.Box=Box=function(){function a(a){this.coords=a}a.prototype.center=function(){return this.barycenter(this.coords[0],this.coords[2])},a.prototype.barycenter=function(a,b){var c,d;c=(a[0]+b[0])/2,d=(a[1]+b[1])/2;return[c,d]};return a}(),window.Server=Server=function(){function a(a,b){var c,d;b==null&&(b={}),this.name=a;for(c in b)d=b[c],this[c]=d}a.prototype.toHtml=function(){var a,b;a='<div class="draggable server '+this.css_class+'" id="srv_'+this.name+'" ',this.link_to&&this.link_to.length>1&&(b=this.link_to.split(",").map(function(a){return"srv_"+$.trim(a)}).join(","),a+='rel="'+b+'" '),a+='style="left:'+this.pos_x+"px; top:"+this.pos_y+'px">',a+="<h5>"+this.name+'<span class="port">:'+this.port+"</span></h5>",this.desc&&(a+="<div>"+this.desc+"</div>"),a+="</div>";return a};return a}(),web_app=[[{name:"lb-intra-01",port:80,css_class:"server-lb",link_to:"apache-01, apache-02"},{name:"lb-intra-02",port:80,css_class:"server-lb server-passive"}],[{name:"apache-01",port:80,desc:"Apache 2.2.3",css_class:"server-rp",link_to:"lb-j2ee-01"},{name:"apache-02",port:80,desc:"Apache 2.2.3",css_class:"server-rp",link_to:"lb-j2ee-01"}],[{name:"lb-j2ee-01",port:80,css_class:"server-lb",link_to:"tomcat-01, tomcat-02, tomcat-03"},{name:"lb-j2ee-02",port:80,css_class:"server-lb server-passive"}],[{name:"tomcat-01",port:80,desc:"Tomcat 6.0.18 - JDK 1.6.0<br>256m &rarr; 1024m",css_class:"server-j2ee",link_to:"postgres-01"},{name:"tomcat-02",port:80,desc:"Tomcat 6.0.18 - JDK 1.6.0<br>256m &rarr; 1024m",css_class:"server-j2ee",link_to:"postgres-01"},{name:"tomcat-03",port:80,desc:"Tomcat 6.0.18 - JDK 1.6.0<br>128m &rarr; 512m",css_class:"server-j2ee",link_to:"postgres-01"}],[{name:"postgres-01",port:5432,desc:"Postgresql 9.0<br>user-01@app-01(5G)",css_class:"server-postgres"},{name:"postgres-02",port:5432,desc:"Postgresql 9.0<br>user-01@app-01(5G)",css_class:"server-postgres server-passive"}]],rhclusters=[["postgres-01","postgres-02"]],heartbeats=[["lb-intra-01","lb-intra-02"],["lb-j2ee-01","lb-j2ee-02"]],servers=[],grid=new Grid({x_start:100,x_step:170,y_start:30,y_step:110}),canvas_xlimits=[0,400],y=grid.options.y_start;for(_i=0,_len=web_app.length;_i<_len;_i++){line=web_app[_i],active=$.grep(line,function(a){return!a.css_class.match(/passive/)}),distrib=grid.distribute_horizontally(active.length,grid.options.x_step,canvas_xlimits[0],canvas_xlimits[1]),x=distrib[0];for(_j=0,_len2=line.length;_j<_len2;_j++)serverJson=line[_j],server=new Server(serverJson.name,serverJson),server.pos_x=x,server.pos_y=y,x+=grid.options.x_step,servers.push(server);y+=grid.options.y_step,line[0].css_class.match(/server-lb/)&&(y-=50)}jQuery(function(){$.each(servers,function(){return $(this.toHtml()).insertBefore($("#canvas"))}),prepareDraggableBoxes(),updateCanvas($("#canvas"),$(".draggable")),$.each(rhclusters,function(){return drawRhclusters(this[0],this[1])});return $.each(heartbeats,function(){return drawHeartbeats(this[0],this[1])})}),$(function(){var a,b,c,d,e,f,g,h,i,j,k;e=Raphael("map",550,450),a={width:150,height:40},g=[],$.each(servers,function(){var b,c,d,f;server=$("#srv_"+this.name),c=this.css_class.match(/server-lb/)?a.height/2:a.height,f=e.rect(this.pos_x,this.pos_y,a.width,c),d=e.text(this.pos_x+a.width/2,this.pos_y+a.height/4-1,this.name),d.attr({"font-size":12}),f.pairs=[],f.pairs.push(d),this.desc&&(b=e.text(this.pos_x+a.width/2,this.pos_y+a.height/4+15,this.desc.replace("<br>","\n")),f.pairs.push(b)),e.set(f,d);return g.push(f)}),c=function(){var a,b,c,d;this.ox=this.attr("x"),this.oy=this.attr("y"),d=this.pairs;for(b=0,c=d.length;b<c;b++)a=d[b],a.ox=a.attr("x"),a.oy=a.attr("y");return this.animate({"fill-opacity":.2},500)},d=function(a,b){var c,d,e,f,g;this.attr({x:this.ox+a,y:this.oy+b}),f=this.pairs,g=[];for(d=0,e=f.length;d<e;d++)c=f[d],g.push(c.attr({x:c.ox+a,y:c.oy+b}));return g},h=function(){return this.animate({"fill-opacity":0},500)},k=[];for(i=0,j=g.length;i<j;i++)f=g[i],b=Raphael.getColor(),f.attr({fill:b,stroke:b,"fill-opacity":0,"stroke-width":2,cursor:"move"}),k.push(f.drag(d,c,h));return k})